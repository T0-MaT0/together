<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="managerMapper">
	
	<!--=================== MANAGE CUSTOMER RESULTMAP =============================-->
	<!-- 고객 상태 -->
	<resultMap type="Member" id="MemberState">
		<id property="memberNo" column="MEMBER_NO"/>
	    <result property="memberId" column="MEMBER_ID"/>
	    <result property="memberPw" column="MEMBER_PW"/>
	    <result property="memberNick" column="MEMBER_NICK"/>
	    <result property="memberName" column="MEMBER_NAME"/>
	    <result property="memberAddr" column="MEMBER_ADDR"/>
	    <result property="memberTel" column="MEMBER_TEL"/>
	    <result property="profileImg" column="PROFILE_IMG"/>
	    <result property="enrollDate" column="ENROLL_DATE"/>
	    <result property="memberEmail" column="MEMBER_EMAIL"/>
	    <result property="memberDelFl" column="MEMBER_DEL_FL"/>
	    <result property="authority" column="AUTHORITY"/>
	    <result property="memberGrade" column="MEMBER_GRADE"/>
	    <result property="memberBirth" column="MEMBER_BIRTH"/>
	    <result property="point" column="POINT"/>
	</resultMap>
	
	<!-- 고객 모집글 -->
	<resultMap type="CustomerBoard" id="Cus_board"></resultMap>
	
	
	<!-- 문의 -->
	<resultMap type="QuestCustomer" id="Quest_cus">
	    <result property="boardNo" column="BOARD_NO"/>
	    <result property="profileImg" column="PROFILE_IMG"/>
	    <result property="memberNick" column="MEMBER_NICK"/>
	    <result property="boardTitle" column="BOARD_TITLE"/>
	    <result property="createDate" column="B_CREATE_DATE"/>
	    <result property="boardDelFl" column="BOARD_DEL_FL"/>		
	</resultMap>
	
	<!-- 신고 -->
	<resultMap type="Report" id="Report">
	    <id property="reportNo" column="REPORT_NO"/>
	    <result property="reportType" column="REPORT_TYPE"/>
	    <result property="memberNick" column="MEMBER_NICK"/>
	    <result property="reportedUserNick" column="REPORTED_USER_NICK"/>
	    <result property="reportTitle" column="REPORT_TITLE"/>
	    <result property="reportDate" column="REPORT_DATE"/>
	    <result property="reportStatus" column="REPORT_STATUS"/>
	</resultMap>
	
	
	<!--=================== MANAGE BRAND RESULTMAP =============================-->	
	
	
	<resultMap type="BrandBoard" id="Brand_Board"></resultMap>
	
	<resultMap type="LookData" id="LookData"></resultMap>
	
	<!-- ===================================================================== -->
	
	<select id="customerQuestionCount" resultType="_int">
		SELECT COUNT(*) 
		FROM BOARD
		JOIN BOARD_TYPE USING(BOARD_CD)
		WHERE BOARD_CD = 6
	</select>
	
	<select id="brandQuestCount" resultType="_int">
		SELECT COUNT(*) 
		FROM BOARD
		JOIN BOARD_TYPE USING(BOARD_CD)
		WHERE BOARD_CD = 8
	</select>
	
	<select id="brandAdCount" resultType="_int">
		SELECT COUNT(*) 
		FROM BOARD
		JOIN BOARD_TYPE USING(BOARD_CD)
		WHERE BOARD_CD = 7
	</select>




	<!--=================== MANAGE CUSTOMER =============================-->
	
	
	<!-- 고객 상태 목록 수 -->
	<select id="customerStateCount" resultType="_int">
		SELECT COUNT(*)
		FROM MEMBER
		WHERE AUTHORITY = 2
	</select>
	
	<!-- 고객 상태 목록 조회  -->
	<select id="customerStateList" resultMap="MemberState">
		SELECT MEMBER_NO, PROFILE_IMG, MEMBER_NICK, MEMBER_EMAIL, MEMBER_GRADE, 
		   TO_CHAR(ENROLL_DATE, 'YYYY-MM-DD') ENROLL_DATE, DECODE(MEMBER_DEL_FL, 'N', '회원', 'Y','탈퇴','B','블랙') MEMBER_DEL_FL 
		FROM MEMBER
		WHERE AUTHORITY = 2
		ORDER BY MEMBER_NO DESC
	</select>
	
	<!-- 총 회원 수 조회 -->
	<select id="customerTotal" resultType="_int">
		SELECT COUNT(*) 
		FROM "MEMBER" 
		WHERE AUTHORITY = 2
		AND MEMBER_DEL_FL ='N'
	</select>
	
	<!-- 신규 회원 수 -->
	<select id="newCustomerCount" resultType='_int'>
		SELECT * FROM MEMBER WHERE ENROLL_DATE BETWEEN SYSDATE-7 AND SYSDATE 
		AND MEMBER_DEL_FL ='N'
	</select>
	
	<!-- 블랙, 회원, 탈퇴 -->
	<select id="CustomersSelect" resultType="map">
		SELECT MEMBER_DEL_FL , COUNT(MEMBER_NO) MEMBER_COUNT
		FROM MEMBER
		GROUP BY MEMBER_DEL_FL
	</select>
	
	<!-- ========================================================================= -->
	<!-- 고객 모집글 목록 수 -->
	<select id="customerboardCount" resultType="_int">
		SELECT COUNT(*) 
		FROM BOARD B
		JOIN "MEMBER" M ON(B.MEMBER_NO= M.MEMBER_NO)
		JOIN RECRUITMENT_ROOM R ON(R.BOARD_NO = B.BOARD_NO)
		WHERE BOARD_CD  = 1
	</select>
	
	<!-- 고객 모집글 목록 조회 -->
	<select id="boardList" resultMap="Cus_board">
		SELECT B.BOARD_NO, MEMBER_NICK, BOARD_TITLE, TO_CHAR( B_CREATE_DATE, 'YYYY-MM-DD') CREATE_DATE
				, TO_CHAR( REC_END_DATE, 'YYYY-MM-DD') END_DATE ,RECRUITMENT_STATUS, BOARD_DEL_FL 
		FROM BOARD B
		JOIN "MEMBER" M ON(B.MEMBER_NO= M.MEMBER_NO)
		JOIN RECRUITMENT_ROOM R ON(R.BOARD_NO = B.BOARD_NO)
		WHERE BOARD_CD  = 1
		ORDER BY B_CREATE_DATE
	</select>
	
	<!-- 총 진행중인 모집글 수  -->
	<select id="totalCustomerBoard" resultType="_int">
		SELECT COUNT(*) FROM BOARD B
		JOIN RECRUITMENT_ROOM R ON(R.BOARD_NO = B.BOARD_NO)
		WHERE BOARD_CD=1 AND BOARD_DEL_FL ='N'	
	</select>
	
	<!-- 마감, 진행, 완료 -->
	<select id="cusBoardStateCount" resultType="map">
		SELECT RECRUITMENT_STATUS, COUNT(*) COUNT FROM BOARD B
		JOIN RECRUITMENT_ROOM R ON(R.BOARD_NO = B.BOARD_NO)
		WHERE BOARD_CD=1
		GROUP BY RECRUITMENT_STATUS 	
	</select>
	
	<!-- 정지 취소 -->
	
	
	<!-- ================================================================ -->
	
	
	<!-- 고객 문의 목록 수 -->
	<select id="questListCount" resultType="_int">
		SELECT COUNT(*) 
		FROM BOARD
		WHERE BOARD_CD = 6
	</select>
	
	<!-- 고객 문의 목록 조회 -->
	<select id="questList" resultMap="Quest_cus">
		SELECT BOARD_NO, PROFILE_IMG, MEMBER_NICK , BOARD_TITLE, TO_CHAR(B_CREATE_DATE, 'YYYY-MM-DD') B_CREATE_DATE , DECODE(BOARD_DEL_FL, 'N', '대기','Y','처리 완료') BOARD_DEL_FL 
		FROM BOARD
		JOIN MEMBER USING(MEMBER_NO)
		WHERE BOARD_CD = 6
		ORDER BY B_CREATE_DATE DESC
	</select>
	
	<!-- 고객 대상 신고 목록 개수  -->
	<select id="reportListCount" resultType="_int">
		SELECT COUNT(*)
		FROM REPORT R
		WHERE REPORT_TYPE IN (2, 3, 4, 5)	
	</select>
	
	<!-- 고객 대상 신고 목록 조회 -->
	<select id="reportSelect" resultMap="Report">
		SELECT DECODE(REPORT_TYPE,1,'브랜드 상품', 2, '모집글',3,'댓글',4,'채팅',5,'리뷰') REPORT_TYPE
			,REPORT_NO, 
			MEMBER_NICK , (SELECT MEMBER_NICK FROM MEMBER M WHERE R.REPORTED_USER_NO= M.MEMBER_NO) REPORTED_USER_NICK
			,REPORT_TITLE, TO_CHAR(REPORT_DATE, 'YYYY-MM-DD') REPORT_DATE, REPORT_STATUS 
		FROM REPORT R
		JOIN MEMBER USING(MEMBER_NO) 
		WHERE REPORT_TYPE IN (2, 3, 4, 5)
		ORDER BY REPORT_DATE DESC 
	</select>
	
	
	<!--=================== MANAGE BRAND =============================-->
		
	<!-- 상품 수 -->
	<select id="goodsCount" resultType="_int">
		SELECT COUNT(*)
		FROM BOARD 
		JOIN MEMBER USING(MEMBER_NO)
		WHERE BOARD_CD =2	
	</select>
	
	<!-- 상품 목록 조회  -->
	<select id="goodsList" resultMap="Brand_Board">
		SELECT BOARD_NO , MEMBER_NICK BRAND_NAME, BOARD_TITLE PRODUCT_TITLE
				, TO_CHAR(B_CREATE_DATE,'YYYY-MM-DD') CREATE_DATE
				,(SELECT PRODUCT_COUNT FROM PRODUCT P WHERE B.BOARD_NO= P.BOARD_NO)  PRODUCT_COUNT
				, DECODE(BOARD_DEL_FL,'N', '판매','Y', '종료') BOARD_DEL_FL
		FROM BOARD B
		JOIN MEMBER USING(MEMBER_NO)
		WHERE BOARD_CD =2
		ORDER BY CREATE_DATE
	</select>
	
	<select id="goodsBoardCount" resultType="_int">
		SELECT COUNT(*)
		FROM BOARD 
		JOIN MEMBER USING(MEMBER_NO)
		WHERE BOARD_CD =2
		AND BOARD_DEL_FL ='Y'	
	</select>
	
	<select id="goodsStateCount" resultType="map">
		SELECT DECODE(BOARD_DEL_FL, 'Y', '종료','N','판매') BOARD_DEL_FL , COUNT(BOARD_NO) COUNT 
		FROM BOARD 
		JOIN MEMBER USING(MEMBER_NO)
		WHERE BOARD_CD =2
		GROUP BY BOARD_DEL_FL 
	</select>
	
	
	<!-- 브랜드 대상 신고 수 -->
	<select id="brandReportCount" resultType='_int'>
		SELECT COUNT(*)
		FROM REPORT R
		JOIN MEMBER USING(MEMBER_NO) 
		WHERE REPORT_TYPE  = 1
	</select>
	
	<!-- 브랜드 대상 신고 목록 조회 -->
	<select id="brandReportList" resultMap='Report'>
		SELECT DECODE(REPORT_TYPE,1,'브랜드 상품', 2, '모집글',3,'댓글',4,'채팅',5,'리뷰') REPORT_TYPE
			,REPORT_NO, 
			MEMBER_NICK , (SELECT MEMBER_NICK FROM MEMBER M WHERE R.REPORTED_USER_NO= M.MEMBER_NO) REPORTED_USER_NICK
			,REPORT_TITLE, TO_CHAR(REPORT_DATE, 'YYYY-MM-DD') REPORT_DATE, REPORT_STATUS 
		FROM REPORT R
		JOIN MEMBER USING(MEMBER_NO) 
		WHERE REPORT_TYPE = 1
		ORDER BY REPORT_DATE DESC 	
	</select>	
	
	<!--제뮤 문의 수  -->
	<select id="applyCount" resultType="_int">
		SELECT COUNT(*)
		FROM BOARD
		JOIN MEMBER USING(MEMBER_NO)
		WHERE BOARD_CD = 8
	</select>
	<!--제뮤 문의 리스트 목록 조회 -->
	<select id="applyList" resultMap="Brand_Board">
		SELECT BOARD_NO, MEMBER_NICK BRAND_NAME, BOARD_TITLE, TO_CHAR(B_CREATE_DATE, 'YYYY-MM-DD') CREATE_DATE , NVL(B_STATE, '대기') BOARD_DEL_FL 
		FROM BOARD
		JOIN MEMBER USING(MEMBER_NO)
		WHERE BOARD_CD = 8
		ORDER BY B_CREATE_DATE DESC
	</select>
	<!-- 제휴 문의 상태 수 -->
	<select id="applyStateCount" resultType="map">
		SELECT NVL(B_STATE, '대기') B_STATE , COUNT(*) COUNT
		FROM BOARD
		JOIN MEMBER USING(MEMBER_NO)
		WHERE BOARD_CD = 8
		GROUP BY B_STATE
	</select>
	
	
	<!-- 광고 신청 수 -->
	<select id="promotionCount" resultType="_int">
		SELECT COUNT(*)
		FROM BOARD
		JOIN MEMBER USING(MEMBER_NO)
		WHERE BOARD_CD = 7	
	</select>
	<!-- 광고 신청 리스트 목록 조회 -->
	<select id="promotionList" resultMap="Brand_Board">
		SELECT BOARD_NO, MEMBER_NICK BRAND_NAME, BOARD_TITLE, TO_CHAR(B_CREATE_DATE, 'YYYY-MM-DD') CREATE_DATE , DECODE(BOARD_DEL_FL, 'N', '대기','Y','처리 완료') BOARD_DEL_FL 
		FROM BOARD
		JOIN MEMBER USING(MEMBER_NO)
		WHERE BOARD_CD = 7
		ORDER BY B_CREATE_DATE DESC
	</select>
	<!-- 광고 신청 상태 수 -->
	<select id="promStateCount" resultType="map">
		SELECT NVL(B_STATE, '대기' ), COUNT(*) COUNT
		FROM BOARD
		JOIN MEMBER USING(MEMBER_NO)
		WHERE BOARD_CD = 7
		GROUP BY B_STATE	
	</select>
	
	<!-- 데이터 성과 리스트 수 -->
	<select id="dataLookCount" resultType="_int">
		SELECT COUNT(*)
		FROM BOARD B, PRODUCT P , MEMBER M
		WHERE B.BOARD_NO = P.BOARD_NO
		AND B.MEMBER_NO = M.MEMBER_NO
		AND BOARD_CD = 2
	</select>

	<!-- 데이터 성과 리스트 조회 -->
	<select id="dataLookList" resultMap="LookData">
		SELECT B.BOARD_NO , MEMBER_NICK BRAND_NAME, BOARD_TITLE, TO_CHAR(B_CREATE_DATE , 'YYYY-MM-DD') CREATE_DATE , READ_COUNT 
		      ,NVL((SELECT SUM(NVL(QUANTITY, 0)) FROM "ORDER" O WHERE B.BOARD_NO=O.BOARD_NO ),0) QUANTITY
		FROM BOARD B, PRODUCT P , MEMBER M
		WHERE B.BOARD_NO = P.BOARD_NO
		AND B.MEMBER_NO = M.MEMBER_NO
		AND BOARD_CD = 2
		ORDER BY QUANTITY DESC, READ_COUNT DESC 
	</select>	
	<!-- 데이터 랭크  -->
	<select id="dataRank" resultType="map">
		SELECT *
		FROM 
		(SELECT  MEMBER_NICK BRAND_NAME, BOARD_TITLE, READ_COUNT 
		      ,NVL((SELECT SUM(NVL(QUANTITY, 0)) FROM "ORDER" O WHERE B.BOARD_NO=O.BOARD_NO ),0) QUANTITY
		FROM BOARD B, PRODUCT P , MEMBER M
		WHERE B.BOARD_NO = P.BOARD_NO
		AND B.MEMBER_NO = M.MEMBER_NO
		AND BOARD_CD = 2
		ORDER BY QUANTITY DESC, READ_COUNT DESC)
		WHERE ROWNUM BETWEEN 1 AND 6	
	</select>
</mapper>
