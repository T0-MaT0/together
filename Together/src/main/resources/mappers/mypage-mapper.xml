<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="mypageMapper">
	<!-- Board DTO에 대한 resultMap -->
	<resultMap type="Business" id="business_rm">
		<id property="boardNo" column="BOARD_NO" />
		<result property="boardName" column="BOARD_NAME" />
		<result property="boardTitle" column="BOARD_TITLE" />
		<result property="boardContent" column="BOARD_CONTENT" />
		<result property="boardCreateDate" column="B_CREATE_DATE" />
		<result property="boardUpdateDate" column="B_UPDATE_DATE" />
		<result property="boardCode" column="BOARD_CD" />
		<result property="productPrice" column="PRODUCT_PRICE" />
		<result property="productCount" column="PRODUCT_COUNT" />
		<result property="deliveryFee" column="DELIVERY_FEE" />
		<result property="readCount" column="READ_COUNT" />
		<result property="categoryNo" column="CATEGORY_NO" />
		<result property="categoryName" column="CATEGORY_NAME" />
		<result property="memberNo" column="MEMBER_NO" />
		<result property="memberNickname" column="MEMBER_NICK" />
		<result property="profileImage" column="PROFILE_IMG" />
		<result property="parentCategoryName" column="PARENT_CATEGORY_NAME" />
		<result property="thumbnail" column="THUMBNAIL" />

		<!--
			collection 태그: select로 조회된 결과를 컬렉션(List)에 담아 지정된 필드에 세팅
			property: List를 담을 DTO의 필드명
			select: 실행할 select의 id
			column: 조회 결과 중 지정된 컬럼의 값을 파라미터로 전달
			javaType: List(컬렉션)의 타입을 지정
			ofType: List(컬렉션)의 제네릭(타입 제한) 지정
		-->
		<collection property="optionList" select="selectOptionList"
					column="BOARD_NO" javaType="java.util.ArrayList"
					ofType="BusinessOption" />
		<collection property="imageList" select="selectImageList"
					column="BOARD_NO" javaType="java.util.ArrayList"
					ofType="Image" />
	</resultMap>

	<!-- Image resultMap -->
	<resultMap type="Image" id="image_rm">
		<id property="imageNo" column="IMG_NO" />
		<result property="imagePath" column="IMG_PATH" />
		<result property="imageReName" column="IMG_RENAME" />
		<result property="imageOriginal" column="IMG_ORIGINAL" />
		<result property="imageLevel" column="IMG_LEVEL" />
		<result property="imageType" column="IMG_TYPE" />
		<result property="imageTypeNo" column="IMG_TYPE_NO" />
	</resultMap>

	<!-- BusinessOption resultMap -->
	<resultMap type="BusinessOption" id="businessOption_rm">
		<id property="optionNo" column="OPTION_NO" />
		<result property="optionName" column="OPTION_NAME" />
		<result property="boardNo" column="BOARD_NO" />
	</resultMap>

	<!-- Review resultMap -->
	<resultMap type="Review" id="review_rm">
		<id property="reviewNo" column="REVIEW_NO" />
		<result property="reviewContent" column="REVIEW_CONTENT" />
		<result property="reviewStar" column="REVIEW_STAR" />
		<result property="reviewCreatedDate" column="REVIEW_CREATED_DATE" />
		<result property="reviewUpdateDate" column="REVIEW_UPDATE_DATE" />
		<result property="reviewDelFleg" column="REVIEW_DEL_FL" />
		<result property="reviewType" column="REVIEW_TYPE" />
		<result property="reviewTypeNo" column="REVIEW_TYPE_NO" />
		<result property="memberNo" column="MEMBER_NO" />
	</resultMap>

	<!-- Reply resultMap -->
	<resultMap type="Reply" id="reply_rm">
		<id property="replyNo" column="REPLY_NO" />
		<result property="replyCreatedDate" column="REPLY_CREATE_DATE" />
		<result property="replyDelFlag" column="REPLY_DEL_FL" />
		<result property="replyContent" column="REPLY_CONTENT" />
		<result property="secretReplyStatus" column="SECRET_REPLY_STATUS" />
		<result property="memberNo" column="MEMBER_NO" />
		<result property="replyType" column="REPLY_TYPE" />
		<result property="replyTypeNo" column="REPLY_TYPE_NO" />
		<result property="parentNo" column="PARENT_REPLY_NO" />
	</resultMap>


	<!--product rm-->
	<resultMap type="Product" id="product_rm">
		<id property="boardNo" column="BOARD_NO" />
		<result property="boardTitle" column="BOARD_TITLE"/>
		<result property="boardContent" column="BOARD_CONTENT" />
		<result property="boardCode" column="BOARD_CD" />
		<result property="imgPath" column="IMG_PATH" />
		<result property="price" column="PRICE" />
		<result property="readCount" column="READ_COUNT" />
		<result property="category" column="CATEGORY_NAME" />
	</resultMap>

	<select id="getPurchaseHistory" resultMap="product_rm">
		SELECT BOARD_NO , BOARD_TITLE , BOARD_CONTENT , BOARD_CD , IMG_PATH || IMG_RENAME IMG_PATH, PRODUCT_PRICE PRICE, READ_COUNT , CATEGORY_NAME
		FROM (SELECT ORDER_NO, BOARD_NO
			  FROM "ORDER"
			  WHERE MEMBER_NO = ${memberNo}
			  ORDER BY ORDER_NO DESC)
				 LEFT JOIN BOARD USING (BOARD_NO)
				 LEFT JOIN (SELECT *
							FROM IMG
							WHERE IMG_TYPE = 1
							  AND IMG_LEVEL = 0
		) ON BOARD_NO = IMG_TYPE_NO
				 LEFT JOIN PRODUCT USING (BOARD_NO)
				 LEFT JOIN CATEGORY USING (CATEGORY_NO)
		WHERE BOARD_DEL_FL = 'N'
		  AND PRODUCT_COUNT > 0
	</select>


</mapper>